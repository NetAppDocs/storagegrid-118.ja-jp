---
permalink: ilm/simulating-ilm-policy-examples.html 
sidebar: sidebar 
keywords: simulate ilm policy 
summary: ILMポリシーシミュレーションの例では、環境に合わせてシミュレーションを構造化および変更するためのガイドラインを示します。 
---
= ILMポリシーのシミュレーション例
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ILMポリシーシミュレーションの例では、環境に合わせてシミュレーションを構造化および変更するためのガイドラインを示します。



== 例1：ILMポリシーをシミュレートしてルールを検証する

この例では、ポリシーをシミュレートするときにルールを検証する方法について説明します。

この例では、 2 つのバケットに取り込まれたオブジェクトに対して * サンプルの ILM ポリシー * をシミュレートします。このポリシーには、次の 3 つのルールが含まれています。

* 最初のルール「 * 2 copies 、 buckets-a * 」の 2 年間は、 bucket-a のオブジェクトにのみ適用されます
* 2 番目のルール「 * EC objects > 1 MB * 、環境 all buckets] は 1MB を超えるオブジェクトをフィルタリングします。
* 3 つ目のルール「 * 2 つのコピー、 2 つのデータセンター」はデフォルトルールです。フィルタは含まれず、参照時間を noncurrent に指定したものは使用しません。


ポリシーをシミュレートしたら、各オブジェクトが正しいルールに一致したことを確認します。

image::../media/simulate_policy_screen.png[ポリシーの結果をシミュレートします]

次の例では、

* `bucket-a/bucket-a object.pdf` のオブジェクトをフィルタリングする最初のルールを正しくマッチングしました `bucket-a`。
* `bucket-b/test object greater than 1 MB.pdf` がにあります `bucket-b`では、最初のルールと一致しませんでした。代わりに、 1MB を超えるオブジェクトをフィルタリングする 2 つ目のルールに正しく一致しました。
* `bucket-b/test object less than 1 MB.pdf` 最初の2つのルールのフィルタに一致しなかったため、フィルタが含まれていないデフォルトルールによって配置されます。




== 例2：ILMポリシーをシミュレートする際にルールの順序を変更する

この例では、ポリシーをシミュレートする際に、ルールの順序を変更して結果を変更する方法を示します。

この例では、 * Demo * ポリシーをシミュレートします。このポリシーの目的は次の 3 つのルールで、 series = x -men ユーザメタデータを含むオブジェクトを検索することです。

* 最初のルール「* PNGs *」はで終わるキー名に対してフィルタを適用します `.png`。
* 2つ目のルール「* X-men」はテナントAのオブジェクトにのみ適用され、フィルタを適用します `series=x-men` ユーザメタデータ。
* 最後のルール「* two copies two data centers *」がデフォルトルールで、最初の2つのルールに一致しないオブジェクトに一致します。


.手順
. ルールを追加してポリシーを保存したら、 * Simulate * を選択します。
. * Object * フィールドに、テストオブジェクトの S3 バケット / オブジェクトキーまたは Swift コンテナ / オブジェクト名を入力し、 * Simulate * を選択します。
+
シミュレーション結果が表示され、が示されます `Havok.png` オブジェクトは「* PNGs *」ルールに一致しました。

+
image::../media/simulate_reorder_rules_pngs_result.png[例2：ILMポリシーをシミュレートする際にルールの順序を変更する]

+
ただし、 `Havok.png` は、* X-men *ルールをテストするためのものです。

. 問題 を解決するには、ルールの順序を変更します。
+
.. [Finish]*を選択して[Simulate ILM Policy]ウィンドウを閉じます。
.. 「 * Edit * 」を選択して、ポリシーを編集します。
.. 「 * X-men 」ルールをリストの先頭にドラッグします。
.. [ 保存（ Save ） ] を選択します。


. 「 * Simulate * 」を選択します。
+
以前にテストしたオブジェクトが更新したポリシーに照らして再評価され、新しいシミュレーション結果が表示されます。この例では、Rule Matchedカラムにが表示されています `Havok.png` 想定どおりに「X-men」メタデータルールに一致します。[Previous Match]列には、PNGsルールが前回のシミュレーションでオブジェクトに一致したことが表示されます。

+
image::../media/simulate_reorder_rules_correct_result.png[例2：ILMポリシーをシミュレートする際にルールの順序を変更する]





== 例3：ILMポリシーをシミュレートするときにルールを修正する

この例では、ポリシーをシミュレートしてポリシー内のルールを修正し、シミュレーションを続行する方法を示します。

この例では、 * Demo * ポリシーをシミュレートします。このポリシーの目的は、が含まれるオブジェクトを検索することです `series=x-men` ユーザメタデータ。ただし、に対してシミュレートしたところ予期しない結果が発生しました `Beast.jpg` オブジェクト。オブジェクトが「 X-men 」メタデータルールではなくデフォルトルールに一致しましたが、 2 つのデータセンターがコピーされています。

image::../media/simulate_results_for_object_wrong_metadata.png[例3：ILMポリシーをシミュレートするときにルールを修正する]

テストオブジェクトがポリシー内の想定したルールに一致しない場合は、ポリシー内の各ルールを調べてエラーを修正する必要があります。

.手順
. [完了]*を選択して[ポリシーのシミュレート]ダイアログを閉じます。ポリシーの詳細ページで、*[保持図]*を選択します。次に、必要に応じて各ルールの*[すべて展開]*または*[詳細を表示]*を選択します。
. ルールのテナントアカウント、参照時間、およびフィルタ条件を確認します。
+
たとえば、「X-men」ルールのメタデータが「x-men」ではなく「x-men01」と入力されたとします。

. エラーを解決するには、次のようにルールを修正します。
+
** ルールがポリシーに含まれている場合は、ルールをクローニングするか、ポリシーから削除して編集します。
** ルールがアクティブポリシーに含まれている場合は、ルールをクローニングする必要があります。アクティブポリシーのルールを編集したり削除したりすることはできません。


. もう一度シミュレーションを実行します。
+
この例では、修正した「X-men」ルールがに一致します `Beast.jpg` に基づくオブジェクト `series=x-men` ユーザメタデータ（期待どおり）。

+
image::../media/simulate_results_for_object_corrected_metadata.png[例3：ILMポリシーをシミュレートするときにルールを修正する]


