---
permalink: maintain/restoring-object-data-to-storage-volume-where-system-drive-is-intact.html 
sidebar: sidebar 
keywords: restore replicated data, restore erasure-coded data, recover storage node, recover storage volume 
summary: システムドライブに損傷がないストレージノードでストレージボリュームをリカバリしたら、ストレージボリュームの障害で失われたレプリケートオブジェクトデータまたはイレイジャーコーディングオブジェクトデータをリストアできます。 
---
= システムドライブに損傷がない場合は、オブジェクトデータをストレージボリュームにリストアします
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
システムドライブに損傷がないストレージノードでストレージボリュームをリカバリしたら、ストレージボリュームの障害で失われたレプリケートオブジェクトデータまたはイレイジャーコーディングオブジェクトデータをリストアできます。



== どの手順 を使用すればよいですか。

可能なかぎり、Grid Managerの*[ボリュームのリストア]*ページを使用してオブジェクトデータをリストアします。

* ボリュームが* maintenance *>* Volume restore *>* Nodes to restore *に表示された場合は、を使用してオブジェクトデータをリストアします link:../maintain/restoring-volume.html["Grid Managerのボリュームリストアページ"]。
* ボリュームが* maintenance *>* Volume restoration *>* Nodes to restore *に表示されない場合は、を使用するために以下の手順を実行してください `repair-data` オブジェクトデータをリストアするスクリプト。
+
リカバリされたストレージノードのボリューム数が交換対象のノードよりも少ない場合は、を使用する必要があります `repair-data` スクリプト：




NOTE: repair-dataスクリプトは廃止され、今後のリリースで削除される予定です。可能な場合は、を使用します link:../maintain/restoring-volume.html["GridManagerテノホリユウムノリストア手順"]。



== を使用します `repair-data` オブジェクトデータをリストアするスクリプト

.作業を開始する前に
* リカバリされたストレージノードの接続状態が* Connected *であることを確認しておきます。 image:../media/icon_alert_green_checkmark.png["緑色のチェックマークのアイコン"] Grid Manager の * nodes * > * Overview * タブをクリックします。


.このタスクについて
グリッドの ILM ルールがオブジェクトコピーを作成するように設定されていた場合、他のストレージノード、アーカイブノード、またはクラウドストレージプールからオブジェクトデータをリストアできます。

次の点に注意してください。

* レプリケートされたコピーを 1 つだけ保存するように ILM ルールが設定されていて、そのコピーがストレージボリュームに障害が発生した場合、オブジェクトをリカバリすることはできません。
* オブジェクトのコピーがクラウドストレージプールにしか残っていない場合、 StorageGRID は、オブジェクトデータをリストアするために複数の要求をクラウドストレージプールエンドポイントに問題 する必要があります。この手順 を実行する前に、テクニカルサポートに問い合わせて、リカバリ期間と関連コストの見積もりを依頼してください。
* オブジェクトのコピーがアーカイブノードにしか残っていない場合は、アーカイブノードからオブジェクトデータが読み出されます。アーカイブノードからストレージノードへのオブジェクトデータのリストアでは、外部アーカイブストレージシステムからの読み出しにレイテンシが伴うため、他のストレージノードからコピーをリストアする場合に比べて時間がかかります。




== について `repair-data` スクリプト

オブジェクトデータをリストアするには、を実行します `repair-data` スクリプト：このスクリプトは、オブジェクトデータのリストアプロセスを開始し、 ILM スキャンと連動して ILM ルールを適用します。

以下の*レプリケートデータ*または*イレイジャーコーディング（EC）データ*を選択して、の各種オプションを確認してください `repair-data` レプリケートデータとイレイジャーコーディングデータのどちらをリストアするかに基づくスクリプト。両方のタイプのデータをリストアする必要がある場合は、両方のコマンドセットを実行する必要があります。


NOTE: 詳細については、を参照してください `repair-data` スクリプトを入力します `repair-data --help` プライマリ管理ノードのコマンドラインを使用します。


NOTE: repair-dataスクリプトは廃止され、今後のリリースで削除される予定です。可能な場合は、を使用します link:../maintain/restoring-volume.html["GridManagerテノホリユウムノリストア手順"]。

[role="tabbed-block"]
====
.レプリケートデータ
--
レプリケートデータをリストアするコマンドは、ノード全体を修復するのか、ノード上の一部のボリュームのみを修復するのかに応じて 2 つあります。

`repair-data start-replicated-node-repair`

`repair-data start-replicated-volume-repair`

レプリケートデータの修復は、次のコマンドで追跡できます。

`repair-data show-replicated-repair-status`

--
.イレイジャーコーディング（EC）データ
--
イレイジャーコーディングデータをリストアするコマンドは、ノード全体を修復するのか、ノード上の一部のボリュームのみを修復するのかに応じて 2 つあります。

`repair-data start-ec-node-repair`

`repair-data start-ec-volume-repair`

イレイジャーコーディングデータの修復は、次のコマンドで追跡できます。

`repair-data show-ec-repair-status`


NOTE: イレイジャーコーディングデータの修復は、一部のストレージノードがオフライン状態で開始できます。ただし、すべてのイレイジャーコーディングデータを把握できない場合は、修復を完了できません。修復はすべてのノードが使用可能になったあとに完了します。


NOTE: EC 修復ジョブによって、大量のストレージが一時的にリザーブされます。ストレージアラートがトリガーされることもありますが、修復が完了すると解決します。予約に必要なストレージが不足していると、 EC の修復ジョブが失敗します。ストレージリザベーションは、ジョブが失敗したか成功したかに関係なく、 EC 修復ジョブが完了すると解放されます。

--
====


== ストレージノードのホスト名を探します

. プライマリ管理ノードにログインします。
+
.. 次のコマンドを入力します。 `ssh admin@_primary_Admin_Node_IP_`
.. に記載されているパスワードを入力します `Passwords.txt` ファイル。
.. 次のコマンドを入力してrootに切り替えます。 `su -`
.. に記載されているパスワードを入力します `Passwords.txt` ファイル。
+
rootとしてログインすると、プロンプトがから変わります `$` 終了： `#`。



. を使用します `/etc/hosts` リストアされたストレージボリュームのストレージノードのホスト名を特定するファイル。グリッド内のすべてのノードのリストを表示するには、次のように入力します。 `cat /etc/hosts`。




== すべてのボリュームで障害が発生した場合はデータを修復します

すべてのストレージボリュームで障害が発生した場合は、ノード全体を修復します。レプリケートデータ、イレイジャーコーディング（ EC ）データ、またはその両方を使用するかどうかに応じて、 * レプリケートデータ * 、 * イレイジャーコーディング（ EC ）データ * 、またはその両方の手順を実行します。

一部のボリュームだけで障害が発生した場合は、に進みます <<一部のボリュームのみで障害が発生した場合はデータを修復します>>。


NOTE: 逃げられない `repair-data` 複数のノードに対して同時に処理を実行すること。複数のノードをリカバリする場合は、テクニカルサポートにお問い合わせください。

[role="tabbed-block"]
====
.レプリケートデータ
--
グリッドにレプリケートデータがある場合は、を使用します `repair-data start-replicated-node-repair` コマンドにを指定します `--nodes` オプション、ここで `--nodes` は、ストレージノード全体を修復するホスト名（システム名）です。

次のコマンドは、 SG-DC-SN3 というストレージノードにあるレプリケートデータを修復します。

`repair-data start-replicated-node-repair --nodes SG-DC-SN3`


NOTE: オブジェクトデータのリストア時に、StorageGRID システムがレプリケートされたオブジェクトデータを見つけられない場合は、* Objects lost *アラートがトリガーされます。システム全体のストレージノードでアラートがトリガーされることがあります。損失の原因 と、リカバリが可能かどうかを確認する必要があります。を参照してください link:../troubleshoot/investigating-lost-objects.html["損失オブジェクトを調査する"]。

--
.イレイジャーコーディング（EC）データ
--
グリッドにイレイジャーコーディングデータが含まれている場合は、を使用します `repair-data start-ec-node-repair` コマンドにを指定します `--nodes` オプション、ここで `--nodes` は、ストレージノード全体を修復するホスト名（システム名）です。

次のコマンドは、 SG-DC-SN3 というストレージノードにあるイレイジャーコーディングデータを修復します。

`repair-data start-ec-node-repair --nodes SG-DC-SN3`

一意のが返されます `repair ID` これを識別します `repair_data` 操作。これを使用します `repair ID` をクリックして、の進捗状況と結果を追跡します `repair_data` 操作。リカバリプロセスが完了しても、それ以外のフィードバックは返されません。


NOTE: イレイジャーコーディングデータの修復は、一部のストレージノードがオフライン状態で開始できます。修復はすべてのノードが使用可能になったあとに完了します。

--
====


== 一部のボリュームのみで障害が発生した場合はデータを修復します

一部のボリュームだけで障害が発生した場合は、影響を受けたボリュームを修復します。レプリケートデータ、イレイジャーコーディング（ EC ）データ、またはその両方を使用するかどうかに応じて、 * レプリケートデータ * 、 * イレイジャーコーディング（ EC ）データ * 、またはその両方の手順を実行します。

すべてのボリュームで障害が発生した場合は、に進みます <<すべてのボリュームで障害が発生した場合はデータを修復します>>。

ボリューム ID を 16 進数で入力します。例： `0000` は、最初のボリュームとです `000F` 16番目のボリュームです。1つのボリューム、一連のボリューム、または連続していない複数のボリュームを指定できます。

すべてのボリュームが同じストレージノードにある必要があります。複数のストレージノードのボリュームをリストアする必要がある場合は、テクニカルサポートにお問い合わせください。

[role="tabbed-block"]
====
.レプリケートデータ
--
グリッドにレプリケートデータがある場合は、を使用します `start-replicated-volume-repair` コマンドにを指定します `--nodes` ノードを識別するオプション（ `--nodes` はノードのホスト名です）。次に、を追加します `--volumes` または `--volume-range` 次の例に示すように、オプションを指定します。

*単一ボリューム*：レプリケートされたデータをボリュームにリストアします `0002` SG-DC-SN3という名前のストレージノードで次のように設定します。

`repair-data start-replicated-volume-repair --nodes SG-DC-SN3 --volumes 0002`

*ボリューム範囲*：レプリケートされたデータを範囲内のすべてのボリュームにリストアします `0003` 終了： `0009` SG-DC-SN3という名前のストレージノードで次のように設定します。

`repair-data start-replicated-volume-repair --nodes SG-DC-SN3 --volume-range 0003,0009`

*複数のボリュームが連続していません*：このコマンドは、複製されたデータをボリュームにリストアします `0001`、 `0005`および `0008` SG-DC-SN3という名前のストレージノードで次のように設定します。

`repair-data start-replicated-volume-repair --nodes SG-DC-SN3 --volumes 0001,0005,0008`


NOTE: オブジェクトデータのリストア時に、StorageGRID システムがレプリケートされたオブジェクトデータを見つけられない場合は、* Objects lost *アラートがトリガーされます。システム全体のストレージノードでアラートがトリガーされることがあります。アラートの概要 と推奨される対処方法をメモして、損失の原因 を特定し、リカバリが可能かどうかを判断します。

--
.イレイジャーコーディング（EC）データ
--
グリッドにイレイジャーコーディングデータが含まれている場合は、を使用します `start-ec-volume-repair` コマンドにを指定します `--nodes` ノードを識別するオプション（ `--nodes` はノードのホスト名です）。次に、を追加します `--volumes` または `--volume-range` 次の例に示すように、オプションを指定します。

*単一ボリューム*：このコマンドは、イレイジャーコーディングデータをボリュームにリストアします `0007` SG-DC-SN3という名前のストレージノードで次のように設定します。

`repair-data start-ec-volume-repair --nodes SG-DC-SN3 --volumes 0007`

*ボリュームの範囲*：このコマンドは、範囲内のすべてのボリュームにイレイジャーコーディングデータをリストアします `0004` 終了： `0006` SG-DC-SN3という名前のストレージノードで次のように設定します。

`repair-data start-ec-volume-repair --nodes SG-DC-SN3 --volume-range 0004,0006`

*複数のボリュームが連続していません*：このコマンドは、イレイジャーコーディングデータをボリュームにリストアします `000A`、 `000C`および `000E` SG-DC-SN3という名前のストレージノードで次のように設定します。

`repair-data start-ec-volume-repair --nodes SG-DC-SN3 --volumes 000A,000C,000E`

。 `repair-data` 一意のが返されます `repair ID` これを識別します `repair_data` 操作。これを使用します `repair ID` をクリックして、の進捗状況と結果を追跡します `repair_data` 操作。リカバリプロセスが完了しても、それ以外のフィードバックは返されません。


NOTE: イレイジャーコーディングデータの修復は、一部のストレージノードがオフライン状態で開始できます。修復はすべてのノードが使用可能になったあとに完了します。

--
====


== 修理を監視する

* レプリケートデータ * 、 * イレイジャーコーディング（ EC ）データ * 、またはその両方を使用しているかどうかに基づいて、修復ジョブのステータスを監視します。

実行中のボリュームリストアジョブのステータスを監視し、で完了したリストアジョブの履歴を表示することもできます
link:../maintain/restoring-volume.html["Grid Manager の略"]。

[role="tabbed-block"]
====
.レプリケートデータ
--
* レプリケートされた修復の完了率を推定するには、を追加します `show-replicated-repair-status` repair-dataコマンドのオプション。
+
`repair-data show-replicated-repair-status`

* 修理が完了しているかどうかを確認するには、次
+
.. ノードを選択 * > * _ 修復中のストレージノード _ * > * ILM * を選択します。
.. 「評価」セクションの属性を確認します。修理が完了すると、 *Awaiting - All * 属性は 0 個のオブジェクトを示します。


* 修理を詳細に監視するには、次の手順を実行します。
+
.. サポート * > * ツール * > * グリッドトポロジ * を選択します。
.. 「 * _grid_* > * _ Storage Node being repaired _ * > * LDR * > * Data Store * 」を選択します。
.. 次の属性を組み合わせて、レプリケートデータの修復が完了したかどうかを可能なかぎり判別します。
+

NOTE: Cassandraに不整合がある可能性があり、失敗した修復は追跡されません。

+
*** * Repairs Attempted （ XRPA ） * ：レプリケートデータの修復の進行状況を追跡します。この属性は、ストレージノードがハイリスクオブジェクトの修復を試みるたびに値が増分します。この属性の値が現在のスキャン期間（ * Scan Period - - Estimated * 属性で指定）よりも長い期間にわたって上昇しない場合、 ILM スキャンはすべてのノードで修復が必要なハイリスクオブジェクトを検出していません。
+

NOTE: ハイリスクオブジェクトとは、完全に失われる危険があるオブジェクトです。ILM設定を満たさないオブジェクトは含まれません。

*** * スキャン期間 - 推定（ XSCM ） * ：この属性を使用して、以前に取り込まれたオブジェクトにポリシー変更が適用されるタイミングを見積もります。「 * Repairs Attempted * 」属性が現在のスキャン期間よりも長くなっていない場合は、複製修復が実行されている可能性があります。スキャン期間は変わる可能性があるので注意してください。* Scan Period - - Estimated （ XSCM ） * 属性は、グリッド全体の環境 を示します。これは、すべてのノードのスキャン期間の最大値です。グリッドの * Scan Period - - Estimated * 属性履歴を照会して、適切な期間を判断できます。






--
.イレイジャーコーディング（EC）データ
--
イレイジャーコーディングデータの修復を監視し、失敗した可能性のある要求を再試行するには、次の手順を実行します。

. イレイジャーコーディングデータの修復ステータスを確認します。
+
** サポート * > * Tools * > * Metrics * を選択して、現在のジョブの完了までの推定時間と完了率を表示します。次に、 Grafana のセクションで * EC Overview * を選択します。グリッド EC ジョブの完了予想時間 * ダッシュボードと * グリッド EC ジョブの完了率 * ダッシュボードを確認します。
** 特定のののステータスを表示するには、このコマンドを使用します `repair-data` 操作：
+
`repair-data show-ec-repair-status --repair-id repair ID`

** すべての修復処理を表示するには、次のコマンドを使用します
+
`repair-data show-ec-repair-status`

+
出力には、などの情報が表示されます `repair ID`以前に、現在実行中のすべての修復。



. 失敗した修復処理が出力された場合は、を使用します `--repair-id` 修復を再試行するオプションです。
+
このコマンドは、修復 ID 6949309319275667690 を使用して、障害が発生したノードの修復を再試行します。

+
`repair-data start-ec-node-repair --repair-id 6949309319275667690`

+
このコマンドは、修復 ID 6949309319275667690 を使用して、障害が発生したボリュームの修復を再試行します。

+
`repair-data start-ec-volume-repair --repair-id 6949309319275667690`



--
====