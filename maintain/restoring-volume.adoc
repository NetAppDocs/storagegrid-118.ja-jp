---
permalink: maintain/restoring-volume.html 
sidebar: sidebar 
keywords: storagegrid, restore, volume 
summary: Grid Managerを使用して、障害が発生したストレージボリュームまたはストレージノードのオブジェクトデータをリストアできます。また、Grid Managerを使用して、進行中のリストアプロセスを監視したり、リストア履歴を表示したりすることもできます。 
---
= Grid Managerを使用してオブジェクトデータをリストアする
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Grid Managerを使用して、障害ストレージボリュームまたはストレージノードのオブジェクトデータをリストアできます。また、Grid Managerを使用して、進行中のリストアプロセスを監視したり、リストア履歴を表示したりすることもできます。

.作業を開始する前に
* 次のいずれかの手順を実行して、障害ボリュームをフォーマットしておきます。
+
** link:../maintain/remounting-and-reformatting-appliance-storage-volumes.html["アプライアンスストレージボリュームの再マウントと再フォーマット（手動手順）"]
** link:../maintain/remounting-and-reformatting-storage-volumes-manual-steps.html["ストレージボリュームの再マウントと再フォーマット（手動手順）"]


* オブジェクトをリストアするストレージノードの接続状態が*接続済み*であることを確認しておきます image:../media/icon_alert_green_checkmark.png["緑色のチェックマークのアイコン"] Grid Manager の * nodes * > * Overview * タブをクリックします。
* 次の点を確認しておきます。
+
** ストレージノードを追加するためのグリッドの拡張が進行中ではありません。
** ストレージノードの運用停止が進行中でないか失敗しました。
** 障害ストレージボリュームのリカバリが実行中ではありません。
** 障害が発生したシステムドライブがあるストレージノードのリカバリが実行中ではありません。
** ECのリバランシングジョブが実行されていません。
** アプライアンスノードのクローニングが実行されていません。




.このタスクについて
ドライブを交換して手動でボリュームをフォーマットすると、* maintenance *>* Volume restore *>* Nodes to restore *タブにそのボリュームがリストア候補として表示されます。

可能なかぎり、Grid Managerの[Volume restoration]ページを使用してオブジェクトデータをリストアします。どちらでもかまいません <<enable-auto-restore-mode,自動リストアモードを有効にする>> ボリュームをリストアする準備ができたときにボリュームのリストアを自動的に開始するには、または <<manually-restore,ボリュームのリストアを手動で実行する>>。次のガイドラインに従ってください。

* ボリュームが* maintenance *>* Volume restore *>* Nodes to restore *に表示された場合は、以下の手順に従ってオブジェクトデータをリストアします。次の場合にボリュームが表示されます。
+
** ノード内の一部の（すべてではない）ストレージボリュームで障害が発生した
** ノード内のすべてのストレージボリュームで障害が発生し、同じ数以上のボリュームに交換中です


+
Grid Managerの[Volume restore]ページでは、も実行できます <<view-restoration-progress,ボリュームのリストアプロセスを監視>> および <<view-restoration-history,復元履歴を表示します>>。

* ボリュームがリストア候補としてGrid Managerに表示されない場合は、を使用するための適切な手順を実行します `repair-data` オブジェクトデータをリストアするスクリプト：
+
** link:restoring-object-data-to-storage-volume.html["ストレージボリュームへのオブジェクトデータのリストア（システムドライブの障害）"]
** link:restoring-object-data-to-storage-volume-where-system-drive-is-intact.html["システムドライブに損傷がない場合は、オブジェクトデータをストレージボリュームにリストアします"]
** link:restoring-object-data-to-storage-volume-for-appliance.html["アプライアンスのストレージボリュームにオブジェクトデータをリストアします"]
+

NOTE: repair-dataスクリプトは廃止され、今後のリリースで削除される予定です。



+
リカバリされたストレージノードのボリューム数が交換対象のノードよりも少ない場合は、を使用する必要があります `repair-data` スクリプト：



次の2種類のオブジェクトデータをリストアできます。

* グリッドのILMルールがオブジェクトコピーを使用できるように設定されている場合、レプリケートデータオブジェクトは別の場所からリストアされます。
+
** レプリケートされたコピーを 1 つだけ保存するように ILM ルールが設定されていて、そのコピーがストレージボリュームに障害が発生した場合、オブジェクトをリカバリすることはできません。
** オブジェクトのコピーがクラウドストレージプールにしか残っていない場合、 StorageGRID は、オブジェクトデータをリストアするために複数の要求をクラウドストレージプールエンドポイントに問題 する必要があります。
** オブジェクトのコピーがアーカイブノードにしか残っていない場合は、アーカイブノードからオブジェクトデータが読み出されます。アーカイブノードからストレージノードへのオブジェクトデータのリストアには、他のストレージノードからオブジェクトコピーをリストアするよりも時間がかかります。


* イレイジャーコーディング（EC）データオブジェクトは、格納されているフラグメントを再編成してリストアされます。破損または損失したフラグメントは、イレイジャーコーディングアルゴリズムによって、残りのデータフラグメントとパリティフラグメントから再作成されます。
+
イレイジャーコーディングデータの修復は、一部のストレージノードがオフライン状態で開始できます。ただし、すべてのイレイジャーコーディングデータを把握できない場合は、修復を完了できません。修復はすべてのノードが使用可能になったあとに完了します。




NOTE: ボリュームのリストアは、オブジェクトコピーが格納されているリソースが使用可能かどうかに依存します。ボリュームのリストアは非線形であり、完了までに数日から数週間かかることがあります。



== [[enable-auto-restore-mode]]自動復元モードを有効にする

自動リストアモードを有効にすると、ボリュームのリストア準備が整うと、ボリュームのリストアが自動的に開始されます。

.手順
. Grid Managerで、*メンテナンス*>*ボリュームのリストア*に移動します。
. [復元するノード]*タブを選択し、*[自動復元モード]*の切り替えをスライドさせて有効な位置にします。
. 確認のダイアログボックスが表示されたら、詳細を確認します。
+
[NOTE]
====
** いずれのノードでも、ボリュームリストアジョブを手動で開始することはできません。
** ボリュームのリストアは、他のメンテナンス手順が実行されていない場合にのみ自動的に開始されます。
** 進捗状況監視ページでジョブのステータスを監視できます。
** StorageGRIDは、開始に失敗したボリュームのリストアを自動的に再試行します。


====
. 自動リストアモードを有効にした結果がわかったら、確認ダイアログボックスで*[はい]*を選択します。
+
自動復元モードはいつでも無効にできます。





== [[manually-restore]]障害が発生したボリュームまたはノードを手動でリストアする

障害が発生したボリュームまたはノードをリストアする手順は、次のとおりです。

.手順
. Grid Managerで、*メンテナンス*>*ボリュームのリストア*に移動します。
. [復元するノード]*タブを選択し、*[自動復元モード]*の切り替えを無効な位置にスライドさせます。
+
タブの数は、リストアが必要なボリュームを含むノードの数を示します。

. 各ノードを展開して、リストアが必要なボリュームとそのステータスを確認します。
. 各ボリュームのリストアを妨げる問題を修正します。ボリュームステータスとして「Waiting for manual steps」（手動手順を待機しています）を選択すると、問題が表示されます。
. リストアするノードを選択します。すべてのボリュームのステータスが[Ready to restore]になっています。
+
ボリュームは一度に1つのノードに対してのみリストアできます。

+
ノード内の各ボリュームがリストアの準備が完了したことを示す必要があります。

. [リストアの開始]*を選択します。
. 表示される可能性のある警告に対処するか、*[とにかく開始]*を選択して警告を無視し、リストアを開始します。


リストアの開始時に、ノードは*[リストアするノード]*タブから*[リストアの進捗状況]*タブに移動します。

ボリュームのリストアを開始できない場合は、*[リストアするノード]*タブに戻ります。



== [[view-restoration-progres]]リストアの進捗状況を表示します

[リストアの進捗状況]*タブには、ボリュームリストアプロセスのステータスと、リストア対象のノードのボリュームに関する情報が表示されます。

すべてのボリュームのレプリケートオブジェクトとイレイジャーコーディングオブジェクトのデータ修復率は、処理中のすべてのリストアをまとめた平均値です。これには、を使用して開始したリストアも含まれます。 `repair-data` スクリプト：これらのボリューム内のオブジェクトのうち、破損しておらず、リストアを必要としないオブジェクトの割合も表示されます。


NOTE: レプリケートされたデータのリストアは、レプリケートされたコピーが格納されているリソースの可用性に依存します。レプリケートされたデータのリストアはノンリニアで、完了までに数日から数週間かかることがあります。

[Restoration jobs]セクションには、Grid Managerから開始されたボリュームリストアに関する情報が表示されます。

* [Restoration jobs]セクションの数値は、リストア中またはリストア用にキューに登録されているボリュームの数を示します。
* このテーブルには、リストア対象のノード内の各ボリュームに関する情報とその進捗状況が表示されます。
+
** 各ノードの進捗状況には、各ジョブの割合が表示されます。
** [Details]列を展開して、リストアの開始時刻とジョブIDを表示します。


* ボリュームのリストアに失敗した場合：
+
** [ステータス]列には、 `failed (attempting retry)`をクリックすると、自動的に再試行されます。
** 複数のリストアジョブが失敗した場合は、最新のジョブが最初に自動的に再試行されます。
** 再試行が失敗し続けると、* EC repair failure *アラートがトリガーされます。アラートに記載されている手順に従って、問題を解決します。






== [[view-restoration-history]]リストア履歴を表示します

[リストア履歴]*タブには、正常に完了したすべてのボリュームリストアに関する情報が表示されます。


NOTE: サイズはレプリケートオブジェクトには適用されず、イレイジャーコーディング（EC）データオブジェクトを含むリストアの場合にのみ表示されます。
