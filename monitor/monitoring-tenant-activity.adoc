---
permalink: monitor/monitoring-tenant-activity.html 
sidebar: sidebar 
keywords: how to monitor tenant activity 
summary: S3およびSwiftクライアントアクティビティはすべてStorageGRID テナントアカウントに関連付けられています。Grid Managerを使用して、すべてのテナントまたは特定のテナントのストレージ使用量またはネットワークトラフィックを監視できます。監査ログまたはGrafanaダッシュボードを使用して、テナントによるStorageGRID の使用状況に関する詳細情報を収集できます。 
---
= テナントのアクティビティを監視する
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
S3およびSwiftクライアントアクティビティはすべてStorageGRID テナントアカウントに関連付けられています。Grid Managerを使用して、すべてのテナントまたは特定のテナントのストレージ使用量またはネットワークトラフィックを監視できます。監査ログまたはGrafanaダッシュボードを使用して、テナントによるStorageGRID の使用状況に関する詳細情報を収集できます。

.作業を開始する前に
* を使用して Grid Manager にサインインします link:../admin/web-browser-requirements.html["サポートされている Web ブラウザ"]。
* を使用することができます link:../admin/admin-group-permissions.html["rootアクセスまたはテナントアカウントの権限"]。




== すべてのテナントを表示します

[Tenants]ページには、現在のすべてのテナントアカウントの基本情報が表示されます。

.手順
. 「 * tenants * 」を選択します
. [Tenant]ページに表示される情報を確認します。
+
各テナントの使用済み論理スペース、クォータ利用率、クォータ、オブジェクト数が表示されます。テナントにクォータが設定されていない場合、 Quota Utilization フィールドと Quota フィールドにはダッシュが表示されます（：）。

+

NOTE: 使用済みスペースの値は推定値です。これらの推定値は、取り込みのタイミング、ネットワーク接続、ノードのステータスによって左右されます。

+
image::../media/tenant_accounts_page.png[テナントアカウントヘエシ]

. 必要に応じて、サインインリンクを選択してテナントアカウントにサインインします image:../media/icon_tenant_sign_in.png["テナントのサインインアイコン"] [サインイン/ URLのコピー（Sign In/Copy URL）]列に表示されます。
. 必要に応じて、[URLのコピー]リンクを選択してテナントのサインインページのURLをコピーします image:../media/icon_tenant_copy_url.png["テナントコピー URL のアイコン"] [サインイン/ URLのコピー（Sign In/Copy URL）]列に表示されます。
. 必要に応じて、*[CSVにエクスポート]*を選択してを表示およびエクスポートします `.csv` すべてのテナントの使用状況の値を含むファイル。
+
を開くか保存するかを確認するメッセージが表示されます `.csv` ファイル。

+
の内容 `.csv` ファイルは次の例のようになります。

+
image::../media/tenant_accounts_example_csv.png[テナントアカウントの例： .csv]

+
を開くことができます `.csv` ファイルをスプレッドシートアプリケーションに保存することも、自動化で使用することもできます。

. オブジェクトが表示されない場合は、必要に応じて*[操作]*>*[削除]*を選択してテナントを削除します。を参照してください link:../admin/deleting-tenant-account.html["テナントアカウントを削除する"]。
+
バケットまたはコンテナが含まれているテナントアカウントは削除できません。





== 特定のテナントを表示します

特定のテナントの詳細を表示できます。

.手順
. [Tenants]ページでテナント名を選択します。
+
テナントの詳細ページが表示されます。

+
image::../media/tenant_usage_modal.png[テナント使用モード]

. ページ上部のテナントの概要を確認します。
+
詳細ページのこのセクションには、テナントのオブジェクト数、クォータ使用率、使用済み論理スペース、クォータの設定など、テナントの概要情報が表示されます。

. [スペースの内訳]タブで、*[スペースの消費]*グラフを確認します。
+
このグラフには、テナントのすべてのS3バケット（またはSwiftコンテナ）のスペース消費の合計が表示されます。

+
このテナントにクォータが設定されている場合は、クォータの使用済み容量と残り容量がテキストで表示されます（例： `85.00 GB of 100 GB used`）。クォータが設定されていない場合、テナントのクォータは無制限で、テキストには使用済みのスペース（例： `85.00 GB used`）。棒グラフは、各バケットまたはコンテナのクォータの割合を示します。テナントがストレージクォータを 1% 以上かつ 1GB 以上超過した場合は、クォータの総容量と超過容量がグラフに表示されます。

+
棒グラフにカーソルを合わせると、各バケットまたはコンテナで使用されるストレージを確認できます。空きスペースセグメントにカーソルを合わせると、残りのストレージクォータを確認できます。

+
image::../media/tenant_bucket_space_consumption_GM.png[テナントバケットの消費バーグラフ]

+

CAUTION: クォータ使用率は内部の推定値に基づいており、場合によっては超過することがあります。たとえば、テナントがクォータを超えた場合、 StorageGRID はテナントがオブジェクトのアップロードを開始したときにクォータをチェックし、新しい取り込みを拒否します。ただし、 StorageGRID では、クォータを超過したかどうかを判断する際に、現在のアップロードのサイズは考慮されません。オブジェクトが削除された場合、クォータ使用率が再計算されるまでテナントが一時的に新しいオブジェクトをアップロードできなくなることがあります。クォータ使用率の計算には 10 分以上かかることがあります。

+

NOTE: テナントのクォータ利用率は、テナントが StorageGRID にアップロードしたオブジェクトデータの総容量（論理サイズ）を示します。クォータ利用率は、これらのオブジェクトおよびそのメタデータのコピーを格納するために使用されるスペース（物理サイズ）を表していません。

+

NOTE: 「* Tenant quota usage high *」アラートルールを有効にすると、テナントがクォータを消費しているかどうかを確認できます。有効にすると、テナントのクォータの 90% が使用されたときにこのアラートがトリガーされます。手順については、を参照してください link:../monitor/editing-alert-rules.html["アラートルールを編集"]。

. [Space breakdown（スペース内訳）]*タブで、*[Bucket details（バケットの詳細）]*を確認します。
+
次の表に、テナントのS3バケット（またはSwiftコンテナ）を示します。使用済みスペースは、バケットまたはコンテナ内のオブジェクトデータの総容量です。この値は、 ILM コピーとオブジェクトメタデータに必要なストレージスペースを表しているわけではありません。

. 必要に応じて、「 * Export to CSV * 」を選択し、各バケットまたはコンテナの使用量の値を含む .csv ファイルを表示してエクスポートします。
+
個 々 のS3テナントの内容 `.csv` ファイルは次の例のようになります。

+
image::../media/tenant_bucket_details_csv.png[テナントバケットの詳細の CSV の例]

+
を開くことができます `.csv` ファイルをスプレッドシートアプリケーションに保存することも、自動化で使用することもできます。

. 必要に応じて、* Allowed features *タブを選択して、テナントに対して有効になっている権限と機能のリストを表示します。を参照してください link:../admin/editing-tenant-account.html["テナントアカウントを編集します"] これらの設定のいずれかを変更する必要がある場合。
. テナントに* Use grid federation connection *権限がある場合は、必要に応じて* Grid federation *タブを選択して接続の詳細を確認します。
+
を参照してください link:../admin/grid-federation-overview.html["グリッドフェデレーションとは"] および link:../admin/grid-federation-manage-tenants.html["グリッドフェデレーションに許可されたテナントを管理します"]。





== ネットワークトラフィックを表示します

テナントにトラフィック分類ポリシーが設定されている場合は、そのテナントのネットワークトラフィックを確認します。

.手順
. * configuration * > * Network * > * traffic classification * を選択します。
+
[Traffic Classification Policies] ページが表示され、既存のポリシーがテーブルにリストされます。

. ポリシーのリストを確認して、特定のテナントに適用されるポリシーを特定します。
. ポリシーに関連付けられている指標を表示するには、ポリシーの左側にあるラジオボタンを選択し、*[Metrics]*を選択します。
. グラフを分析して、ポリシーがトラフィックを制限している頻度と、ポリシーを調整する必要があるかどうかを判断します。


を参照してください link:../admin/managing-traffic-classification-policies.html["トラフィック分類ポリシーを管理します"] を参照してください。



== 監査ログを使用します

必要に応じて、監査ログを使用してテナントのアクティビティをより詳細に監視できます。

たとえば、次の種類の情報を監視できます。

* PUT 、 GET 、 DELETE など、特定のクライアント処理
* オブジェクトサイズ
* オブジェクトに適用されている ILM ルール
* クライアント要求の送信元 IP


監査ログは、選択したログ分析ツールを使用して分析可能なテキストファイルに書き込まれます。これにより、クライアントアクティビティをよりよく理解したり、高度なチャージバックおよび課金モデルを実装したりできます。

を参照してください link:../audit/index.html["監査ログを確認します"] を参照してください。



== Prometheus指標を使用

必要に応じて、Prometheus指標を使用してテナントアクティビティをレポートします。

* Grid Manager で、 * support * > * Tools * > * Metrics * を選択します。S3 の概要など、既存のダッシュボードを使用してクライアントのアクティビティを確認できます。
+

NOTE: Metrics ページで使用できるツールは、主にテクニカルサポートが使用することを目的としています。これらのツールの一部の機能およびメニュー項目は、意図的に機能しないようになっています。

* Grid Managerの上部でヘルプアイコンを選択し、*[API documentation]*を選択します。グリッド管理 API の指標セクションの指標を使用して、テナントアクティビティ用のカスタムのアラートルールとダッシュボードを作成できます。


を参照してください link:reviewing-support-metrics.html["サポート指標を確認"] を参照してください。
